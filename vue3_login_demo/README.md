## Web3 登录（前后端交互）

**核心要点**
- Nonce 一次性挑战串，防重放与伪造，必须先取再签
- 私钥不出端：本地钱包签名，后端仅验签与地址匹配
- 错误可视化：网络失败/拒签统一提示，交互清晰

**面试常问**
- 为什么不用钱包地址直接登录？→ Nonce + 签名证明私钥控制权
- 为什么还要 JWT？→ Web3 负责身份认证，会话管理交给 JWT
- 会不会扣钱？→ signMessage 不是交易，不上链，无 gas

**SIWE（EIP‑4361）标准登录**
- 防钓鱼：结构化消息包含域分隔与用途说明
- 文本结构标准化：签名内容可读、可审计
- 钱包 UI 明确提示“Sign‑In With Ethereum”

**登录签名 vs 授权交易**

| 行为        | 是否上链 | 是否扣钱 |
|-------------|----------|----------|
| signMessage | 否       | 否       |
| approve     | 是       | 否       |
| transfer    | 是       | 是       |

提示：登录签名仅用于身份确认，不产生任何链上状态变更。

**终极面试回答**
- 采用 EIP‑4361 或自定义 nonce 机制，用户用钱包对登录消息签名
- 后端用 `verifyMessage`/`ecrecover` 验证地址控制权，成功后签发 JWT 维持会话
- 全流程不暴露私钥、不上链，nonce 防重放，登录签名与授权交易严格区分